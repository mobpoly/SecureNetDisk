# å®‰å…¨ç½‘ç»œåŠ å¯†ç£ç›˜ç³»ç»Ÿ - åŠŸèƒ½è¯´æ˜Žæ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºŽå®‰å…¨è®¤è¯ã€åŠ å¯†ä¼ è¾“å’ŒåŠ å¯†å­˜å‚¨çš„ç½‘ç»œåŠ å¯†ç£ç›˜ç³»ç»Ÿï¼Œé‡‡ç”¨ Python å…¨æ ˆå¼€å‘ï¼Œå®žçŽ°äº†ç«¯åˆ°ç«¯åŠ å¯†çš„æ–‡ä»¶å­˜å‚¨å’Œå…±äº«åŠŸèƒ½ã€‚

### 1.1 æŠ€æœ¯æž¶æž„

- **æž¶æž„æ¨¡å¼**: å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C/S) æž¶æž„
- **å¼€å‘è¯­è¨€**: Python 3.8+
- **UI æ¡†æž¶**: PyQt6 (Material Design é£Žæ ¼)
- **æ•°æ®åº“**: SQLite
- **åŠ å¯†åº“**: PyCryptodome, bcrypt

### 1.2 å®‰å…¨ç‰¹æ€§

| åŠŸèƒ½ | å®žçŽ°æ–¹æ¡ˆ |
|------|----------|
| å¯†ç ä¼ è¾“ | SHA-256 é¢„å“ˆå¸Œï¼ˆå®¢æˆ·ç«¯ï¼‰ |
| å¯†ç å­˜å‚¨ | bcrypt åŠ ç›å“ˆå¸Œï¼ˆæœåŠ¡ç«¯ï¼‰ |
| é€šä¿¡åŠ å¯† | AES-256-CTR + HMAC-SHA256 |
| å¯†é’¥äº¤æ¢ | Diffie-Hellman (RFC 3526 Group 14) |
| æ–‡ä»¶åŠ å¯† | AES-256-CBCï¼ˆç«¯åˆ°ç«¯åŠ å¯†ï¼‰ |
| ç”¨æˆ·å¯†é’¥ | RSA-2048ï¼ˆå…¬ç§é’¥å¯¹ï¼‰ |
| æ¶ˆæ¯å®Œæ•´æ€§ | HMAC-SHA256 |

---

## 2. ç”¨æˆ·è®¤è¯æ¨¡å—

### 2.1 ç”¨æˆ·æ³¨å†Œ

**åŠŸèƒ½æè¿°**: åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·

**æµç¨‹**:
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
2. å®¢æˆ·ç«¯éªŒè¯å¯†ç å¼ºåº¦ï¼ˆâ‰¥8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰
3. å®¢æˆ·ç«¯ç”Ÿæˆï¼š
   - ä¸»å¯†é’¥ (32å­—èŠ‚éšæœº)
   - RSA å¯†é’¥å¯¹ (2048ä½)
   - æ¢å¤å¯†é’¥
4. å¯†ç  SHA-256 é¢„å“ˆå¸ŒåŽå‘é€
5. æœåŠ¡ç«¯å­˜å‚¨ bcrypt(SHA256(password))

**ç•Œé¢ä½ç½®**: ç™»å½•å¯¹è¯æ¡† â†’ "æ³¨å†Œ" æ ‡ç­¾é¡µ

### 2.2 ç”¨æˆ·ç™»å½•

**åŠŸèƒ½æè¿°**: éªŒè¯ç”¨æˆ·èº«ä»½å¹¶è§£é”å¯†é’¥

**æµç¨‹**:
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. å®¢æˆ·ç«¯å¯¹å¯†ç è¿›è¡Œ SHA-256 é¢„å“ˆå¸Œ
3. å‘é€é¢„å“ˆå¸Œå€¼åˆ°æœåŠ¡ç«¯ï¼ˆé€šè¿‡åŠ å¯†é€šé“ï¼‰
4. æœåŠ¡ç«¯ä½¿ç”¨ bcrypt éªŒè¯
5. éªŒè¯æˆåŠŸåŽè¿”å›žç”¨æˆ·åŠ å¯†æ•°æ®
6. å®¢æˆ·ç«¯ç”¨å¯†ç è§£é”ä¸»å¯†é’¥å’Œç§é’¥

**ç•Œé¢ä½ç½®**: ç™»å½•å¯¹è¯æ¡† â†’ "ç™»å½•" æ ‡ç­¾é¡µ

### 2.3 é€€å‡ºç™»å½•

**åŠŸèƒ½æè¿°**: å®‰å…¨é€€å‡ºå¹¶æ¸…é™¤å†…å­˜ä¸­çš„å¯†é’¥

**æµç¨‹**:
1. ç‚¹å‡»é€€å‡ºæŒ‰é’®ï¼Œç¡®è®¤é€€å‡º
2. æ¸…é™¤å†…å­˜ä¸­çš„ä¸»å¯†é’¥å’Œç§é’¥
3. å…³é—­ä¸»çª—å£ï¼Œè¿”å›žç™»å½•ç•Œé¢
4. å¯é‡æ–°ç™»å½•æˆ–åˆ‡æ¢è´¦å·

**ç•Œé¢ä½ç½®**: ä¸»çª—å£ä¾§è¾¹æ  â†’ "ðŸšª é€€å‡ºç™»å½•"

### 2.4 å¯†ç æ¢å¤

**åŠŸèƒ½æè¿°**: ä½¿ç”¨æ¢å¤å¯†é’¥é‡ç½®å¯†ç 

**æµç¨‹**:
1. è¾“å…¥ç”¨æˆ·åå’Œæ¢å¤å¯†é’¥
2. éªŒè¯æ¢å¤å¯†é’¥æœ‰æ•ˆæ€§
3. è§£é”ä¸»å¯†é’¥
4. è®¾ç½®æ–°å¯†ç å¹¶é‡æ–°åŠ å¯†ä¸»å¯†é’¥

**ç•Œé¢ä½ç½®**: ç™»å½•å¯¹è¯æ¡† â†’ "å¿˜è®°å¯†ç "

---

## 3. æ–‡ä»¶ç®¡ç†æ¨¡å—

### 3.1 æ–‡ä»¶ä¸Šä¼ 

**åŠŸèƒ½æè¿°**: åŠ å¯†å¹¶ä¸Šä¼ æ–‡ä»¶åˆ°äº‘ç«¯

**æµç¨‹**:
1. é€‰æ‹©æœ¬åœ°æ–‡ä»¶
2. ç”Ÿæˆéšæœºæ–‡ä»¶å¯†é’¥ (32å­—èŠ‚)
3. ä½¿ç”¨ AES-256-CBC åŠ å¯†æ–‡ä»¶å†…å®¹
4. ä½¿ç”¨ä¸»å¯†é’¥åŠ å¯†æ–‡ä»¶å¯†é’¥
5. åˆ†å—ä¸Šä¼ åŠ å¯†æ•°æ®åˆ°æœåŠ¡ç«¯

**ç•Œé¢ä½ç½®**: å·¥å…·æ  â†’ "â¬†ï¸ ä¸Šä¼ æ–‡ä»¶" æˆ– æ–°å»ºèœå•

### 3.2 æ–‡ä»¶ä¸‹è½½

**åŠŸèƒ½æè¿°**: ä¸‹è½½å¹¶è§£å¯†æ–‡ä»¶

**æµç¨‹**:
1. å³é”®ç‚¹å‡»æ–‡ä»¶ â†’ "ä¸‹è½½"
2. é€‰æ‹©ä¿å­˜ä½ç½®
3. ä»ŽæœåŠ¡ç«¯ä¸‹è½½åŠ å¯†æ•°æ®
4. ä½¿ç”¨ä¸»å¯†é’¥è§£å¯†æ–‡ä»¶å¯†é’¥
5. ä½¿ç”¨æ–‡ä»¶å¯†é’¥è§£å¯†æ–‡ä»¶å†…å®¹
6. ä¿å­˜æ˜Žæ–‡æ–‡ä»¶åˆ°æœ¬åœ°

**ç•Œé¢ä½ç½®**: æ–‡ä»¶åˆ—è¡¨ â†’ å³é”®èœå• â†’ "ðŸ“¥ ä¸‹è½½"

### 3.3 æ–‡ä»¶å¤¹ç®¡ç†

**åŠŸèƒ½æè¿°**: åˆ›å»ºå’Œç®¡ç†æ–‡ä»¶å¤¹å±‚çº§

- **åˆ›å»ºæ–‡ä»¶å¤¹**: å·¥å…·æ  â†’ "ðŸ“ æ–°å»ºæ–‡ä»¶å¤¹"
- **è¿›å…¥æ–‡ä»¶å¤¹**: åŒå‡»æ–‡ä»¶å¤¹
- **è¿”å›žä¸Šçº§**: ç‚¹å‡»è·¯å¾„å¯¼èˆª

### 3.4 æ–‡ä»¶æ“ä½œ

| æ“ä½œ | è¯´æ˜Ž | å…¥å£ |
|------|------|------|
| é‡å‘½å | ä¿®æ”¹æ–‡ä»¶/æ–‡ä»¶å¤¹åç§° | å³é”®èœå• â†’ "âœï¸ é‡å‘½å" |
| åˆ é™¤ | åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹ | å³é”®èœå• â†’ "ðŸ—‘ï¸ åˆ é™¤" |
| åˆ·æ–° | é‡æ–°èŽ·å–æ–‡ä»¶åˆ—è¡¨ | å·¥å…·æ  â†’ "ðŸ”„ åˆ·æ–°" |

---

## 4. ç¾¤ç»„å…±äº«æ¨¡å—

### 4.1 åˆ›å»ºç¾¤ç»„

**åŠŸèƒ½æè¿°**: åˆ›å»ºæ–°çš„å…±äº«ç¾¤ç»„

**æµç¨‹**:
1. ç‚¹å‡»æ–°å»ºèœå• â†’ "ðŸ‘¥ åˆ›å»ºç¾¤ç»„"
2. è¾“å…¥ç¾¤ç»„åç§°
3. ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆç¾¤ç»„å¯†é’¥
4. åˆ›å»ºè€…æˆä¸ºç¾¤ç»„ç®¡ç†å‘˜

**ç•Œé¢ä½ç½®**: æ–°å»ºèœå• â†’ "ðŸ‘¥ åˆ›å»ºç¾¤ç»„"

### 4.2 é‚€è¯·ç”¨æˆ·

**åŠŸèƒ½æè¿°**: é‚€è¯·å…¶ä»–ç”¨æˆ·åŠ å…¥ç¾¤ç»„

**æµç¨‹**:
1. ç‚¹å‡»æ–°å»ºèœå• â†’ "ðŸ“¨ é‚€è¯·ç”¨æˆ·åŠ å…¥ç¾¤ç»„"
2. é€‰æ‹©ç›®æ ‡ç¾¤ç»„
3. è¾“å…¥è¢«é‚€è¯·ç”¨æˆ·çš„ç”¨æˆ·å
4. ç³»ç»ŸèŽ·å–è¢«é‚€è¯·ç”¨æˆ·çš„å…¬é’¥
5. ä½¿ç”¨å…¶å…¬é’¥åŠ å¯†ç¾¤ç»„å¯†é’¥
6. å‘é€é‚€è¯·

**ç•Œé¢ä½ç½®**: æ–°å»ºèœå• â†’ "ðŸ“¨ é‚€è¯·ç”¨æˆ·åŠ å…¥ç¾¤ç»„"

### 4.3 å¤„ç†é‚€è¯·

**åŠŸèƒ½æè¿°**: æŽ¥å—æˆ–æ‹’ç»ç¾¤ç»„é‚€è¯·

**æµç¨‹**:
1. ç‚¹å‡»æ–°å»ºèœå• â†’ "ðŸ“¬ æŸ¥çœ‹å¾…å¤„ç†é‚€è¯·"
2. æŸ¥çœ‹é‚€è¯·åˆ—è¡¨ï¼ˆæ˜¾ç¤ºé‚€è¯·äººå’Œç¾¤ç»„åç§°ï¼‰
3. é€‰æ‹©æŽ¥å—æˆ–æ‹’ç»
4. æŽ¥å—åŽï¼Œä½¿ç”¨ç§é’¥è§£å¯†ç¾¤ç»„å¯†é’¥
5. æˆä¸ºç¾¤ç»„æˆå‘˜

**ç•Œé¢ä½ç½®**: æ–°å»ºèœå• â†’ "ðŸ“¬ æŸ¥çœ‹å¾…å¤„ç†é‚€è¯·"

### 4.4 ç¾¤ç»„æ–‡ä»¶

**åŠŸèƒ½æè¿°**: åœ¨ç¾¤ç»„ç©ºé—´ä¸­ç®¡ç†å…±äº«æ–‡ä»¶

**æµç¨‹**:
1. ç‚¹å‡»ä¾§è¾¹æ  â†’ "ðŸ‘¥ å…±äº«ç¾¤ç»„"
2. é€‰æ‹©è¦è¿›å…¥çš„ç¾¤ç»„
3. åœ¨ç¾¤ç»„ç©ºé—´ä¸­ä¸Šä¼ /ä¸‹è½½/ç®¡ç†æ–‡ä»¶
4. ç¾¤ç»„æ–‡ä»¶ä½¿ç”¨ç¾¤ç»„å¯†é’¥åŠ å¯†

**ç•Œé¢ä½ç½®**: ä¾§è¾¹æ  â†’ "ðŸ‘¥ å…±äº«ç¾¤ç»„"

---

## 5. å®‰å…¨é€šä¿¡åè®®

### 5.1 æ¡æ‰‹æµç¨‹

```
å®¢æˆ·ç«¯                              æœåŠ¡ç«¯
   |                                   |
   |-- CLIENT_HELLO (DH å…¬é’¥) -------->|
   |                                   |
   |<-- SERVER_HELLO (DH å…¬é’¥+ç­¾å) ---|
   |                                   |
   |-- KEY_EXCHANGE (éªŒè¯) ----------->|
   |                                   |
   |<-------- FINISHED ----------------|
   |                                   |
   |====== å®‰å…¨é€šé“å»ºç«‹ ================|
```

### 5.2 æ•°æ®åŒ…æ ¼å¼

```
+----------------+----------------+----------------+----------------+
|  Magic (4B)    |  Version (1B)  |  Type (1B)     |  Flags (2B)    |
+----------------+----------------+----------------+----------------+
|  Sequence (4B)                 |  Timestamp (8B)                  |
+----------------+----------------+----------------+----------------+
|  Payload Length (4B)           |  HMAC (32B)                      |
+----------------+----------------+----------------+----------------+
|  Encrypted Payload (Variable)                                     |
+----------------+----------------+----------------+----------------+
```

### 5.3 å®‰å…¨æœºåˆ¶

- **é˜²é‡æ”¾æ”»å‡»**: åºåˆ—å· + æ—¶é—´æˆ³éªŒè¯
- **æ¶ˆæ¯å®Œæ•´æ€§**: HMAC-SHA256 ç­¾å
- **æ•°æ®åŠ å¯†**: AES-256-CTR åŠ å¯†
- **å¯†é’¥åå•†**: DH å¯†é’¥äº¤æ¢ + RSA ç­¾åé˜²ä¸­é—´äºº

---

## 6. å¯†é’¥ç®¡ç†æž¶æž„

### 6.1 å¯†é’¥å±‚çº§

```
ç”¨æˆ·å¯†ç 
    â”‚
    â”œâ”€â”€â”€ SHA-256 é¢„å“ˆå¸Œ â”€â”€â†’ ä¼ è¾“åˆ°æœåŠ¡ç«¯
    â”‚
    â””â”€â”€â”€ PBKDF2 æ´¾ç”Ÿ â”€â”€â†’ ä¸»å¯†é’¥åŠ å¯†å¯†é’¥
                              â”‚
                              â””â”€â”€â”€ è§£å¯†ä¸»å¯†é’¥
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“                   â†“
               RSA ç§é’¥            æ–‡ä»¶å¯†é’¥             ç¾¤ç»„å¯†é’¥
```

### 6.2 å¯†é’¥å­˜å‚¨

| å¯†é’¥ç±»åž‹ | å­˜å‚¨ä½ç½® | åŠ å¯†æ–¹å¼ |
|----------|----------|----------|
| å¯†ç å“ˆå¸Œ | æœåŠ¡ç«¯æ•°æ®åº“ | bcrypt(SHA256(pwd)) |
| ä¸»å¯†é’¥ | æœåŠ¡ç«¯ (åŠ å¯†) | AES(PBKDF2(pwd)) |
| RSA ç§é’¥ | æœåŠ¡ç«¯ (åŠ å¯†) | AES(ä¸»å¯†é’¥) |
| RSA å…¬é’¥ | æœåŠ¡ç«¯ (æ˜Žæ–‡) | æ—  |
| æ–‡ä»¶å¯†é’¥ | æœåŠ¡ç«¯ (åŠ å¯†) | AES(ä¸»å¯†é’¥) |
| ç¾¤ç»„å¯†é’¥ | æœåŠ¡ç«¯ (åŠ å¯†) | RSA(ç”¨æˆ·å…¬é’¥) |

---

## 7. é¡¹ç›®ç»“æž„

```
secure_disk/
â”œâ”€â”€ client/                 # å®¢æˆ·ç«¯æ¨¡å—
â”‚   â”œâ”€â”€ main.py            # å®¢æˆ·ç«¯å…¥å£
â”‚   â”œâ”€â”€ network.py         # ç½‘ç»œé€šä¿¡
â”‚   â”œâ”€â”€ key_manager.py     # å¯†é’¥ç®¡ç†
â”‚   â”œâ”€â”€ file_crypto.py     # æ–‡ä»¶åŠ è§£å¯†
â”‚   â””â”€â”€ ui/                # ç”¨æˆ·ç•Œé¢
â”‚       â”œâ”€â”€ login_dialog.py
â”‚       â”œâ”€â”€ main_window.py
â”‚       â””â”€â”€ styles.py
â”œâ”€â”€ server/                 # æœåŠ¡ç«¯æ¨¡å—
â”‚   â”œâ”€â”€ main.py            # æœåŠ¡ç«¯å…¥å£
â”‚   â”œâ”€â”€ tcp_server.py      # TCP æœåŠ¡å™¨
â”‚   â”œâ”€â”€ handler.py         # è¯·æ±‚å¤„ç†
â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ file_storage.py    # æ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ crypto/                 # åŠ å¯†æ¨¡å—
â”‚   â”œâ”€â”€ aes.py             # AES åŠ å¯†
â”‚   â”œâ”€â”€ rsa.py             # RSA åŠ å¯†
â”‚   â”œâ”€â”€ dh.py              # DH å¯†é’¥äº¤æ¢
â”‚   â”œâ”€â”€ hmac_auth.py       # HMAC è®¤è¯
â”‚   â””â”€â”€ kdf.py             # å¯†é’¥æ´¾ç”Ÿ
â”œâ”€â”€ protocol/               # åè®®æ¨¡å—
â”‚   â”œâ”€â”€ packet.py          # æ•°æ®åŒ…å®šä¹‰
â”‚   â”œâ”€â”€ handshake.py       # æ¡æ‰‹åè®®
â”‚   â”œâ”€â”€ session.py         # ä¼šè¯ç®¡ç†
â”‚   â””â”€â”€ secure_channel.py  # å®‰å…¨é€šé“
â”œâ”€â”€ auth/                   # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ user.py            # ç”¨æˆ·æ¨¡åž‹
â”‚   â”œâ”€â”€ password.py        # å¯†ç å¤„ç†
â”‚   â””â”€â”€ master_key.py      # ä¸»å¯†é’¥ç®¡ç†
â”œâ”€â”€ groups/                 # ç¾¤ç»„æ¨¡å—
â”‚   â”œâ”€â”€ group_manager.py   # ç¾¤ç»„ç®¡ç†
â”‚   â””â”€â”€ group_key.py       # ç¾¤ç»„å¯†é’¥
â””â”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
```

---

## 8. å¿«é€Ÿå¼€å§‹

### 8.1 å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 8.2 å¯åŠ¨æœåŠ¡ç«¯

```bash
python -m server.main
```

æœåŠ¡ç«¯é»˜è®¤ç›‘å¬ `localhost:9000`

### 8.3 å¯åŠ¨å®¢æˆ·ç«¯

```bash
python -m client.main
```

### 8.4 é¦–æ¬¡ä½¿ç”¨

1. ç‚¹å‡» "æ³¨å†Œ" æ ‡ç­¾é¡µ
2. å¡«å†™ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
3. ç‚¹å‡» "æ³¨å†Œ" æŒ‰é’®
4. **ä¿å­˜æ˜¾ç¤ºçš„æ¢å¤å¯†é’¥**ï¼ˆç”¨äºŽå¯†ç æ‰¾å›žï¼‰
5. æ³¨å†ŒæˆåŠŸåŽè‡ªåŠ¨ç™»å½•

---

## 9. æ³¨æ„äº‹é¡¹

1. **æ¢å¤å¯†é’¥**: æ³¨å†Œæ—¶è¯·åŠ¡å¿…ä¿å­˜æ¢å¤å¯†é’¥ï¼Œè¿™æ˜¯æ‰¾å›žå¯†ç çš„å”¯ä¸€æ–¹å¼
2. **å¯†é’¥å®‰å…¨**: æ‰€æœ‰å¯†é’¥ä»…åœ¨å®¢æˆ·ç«¯å†…å­˜ä¸­è§£å¯†ï¼ŒæœåŠ¡ç«¯æ— æ³•èŽ·å–æ˜Žæ–‡
3. **ç«¯åˆ°ç«¯åŠ å¯†**: æ–‡ä»¶åœ¨æœ¬åœ°åŠ å¯†åŽä¸Šä¼ ï¼ŒæœåŠ¡ç«¯å­˜å‚¨çš„æ˜¯å¯†æ–‡
4. **ç¾¤ç»„å®‰å…¨**: ç¾¤ç»„å¯†é’¥é€šè¿‡ RSA å…¬é’¥åŠ å¯†åˆ†å‘ï¼Œåªæœ‰æˆå‘˜å¯è§£å¯†
5. **æ•°æ®åº“é‡ç½®**: ä¿®æ”¹è®¤è¯é€»è¾‘åŽéœ€åˆ é™¤æ—§æ•°æ®åº“å¹¶é‡æ–°æ³¨å†Œ

---

## 10. ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: 1.0.0
- **æ›´æ–°æ—¥æœŸ**: 2026-01-12
- **ä½œè€…**: å®‰å…¨ç½‘ç›˜å¼€å‘å›¢é˜Ÿ
